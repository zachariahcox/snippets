# SLSA Build Level 3 compliant build workflow
# Uses slsa-framework/slsa-github-generator reusable workflow for tamper-proof provenance
# See: https://docs.github.com/en/actions/security-for-github-actions/using-artifact-attestations/using-artifact-attestations-and-reusable-workflows-to-achieve-slsa-v1-build-level-3

name: SLSA Build

on:
  push:
    branches: [main]
    tags: ["v*"]
  workflow_dispatch:

permissions:
  attestations: write
  contents: read
  id-token: write

jobs:
  build:
    uses: slsa-framework/slsa-github-generator/.github/workflows/builder_go_slsa3.yml@v2.0.0
    with:
      go-version: "1.21"
      go-version-file: go.mod
      # Upload binary + provenance to GitHub release only when building from a tag
      upload-assets: ${{ startsWith(github.ref, 'refs/tags/') }}
      config-file: .slsa-goreleaser.yml
